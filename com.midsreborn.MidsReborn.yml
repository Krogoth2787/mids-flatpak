app-id: com.midsreborn.MidsReborn
runtime: org.freedesktop.Platform
runtime-version: '24.08'
sdk: org.freedesktop.Sdk
base: org.winehq.Wine
base-version: stable-24.08
command: mids.sh

# Support 32-bit at runtime
add-extensions:
    org.freedesktop.Platform.Compat.i386:
        directory: lib/i386-linux-gnu
        version: '24.08'

# Support 32-bit at buildtime
sdk-extensions:
    - org.freedesktop.Sdk.Compat.i386
    - org.freedesktop.Sdk.Extension.toolchain-i386
    - org.freedesktop.Sdk.Extension.mono6

inherit-extensions:
  - org.freedesktop.Platform.GL32
  - org.freedesktop.Platform.ffmpeg-full
  - org.freedesktop.Platform.ffmpeg_full.i386
  - org.winehq.Wine.gecko
  - org.winehq.Wine.mono
  - org.winehq.Wine.DLLs

finish-args:
    - --env=WINEDEBUG=-all
    - --share=ipc
    - --share=network
    - --socket=x11
    - --socket=wayland
    - --socket=pulseaudio
    - --allow=multiarch
    - --talk-name=org.freedesktop.Flatpak
    - --filesystem=host:rw
    - --persist=~/.local/share/mids-flatpak
    - --env=LD_LIBRARY_PATH=/app/lib:/app/lib32:/app/lib64:/app/lib/i386-linux-gnu:/app/lib/wine:/app/lib64/wine

modules:
    # Create 32-bit directories
    - name: compat
      buildsystem: simple
      build-commands:
          - mkdir -p /app/lib/i386-linux-gnu
          - mkdir -p /app/lib/debug/lib/i386-linux-gnu
          - mkdir -p /app/lib/udev/rules.d
          - mkdir -p /app/extensions/Plugins
          - mkdir -p /app/lib64
          - mkdir -p /app/lib32

    - name: fake-sudo
      buildsystem: simple
      build-commands:
        - echo '#!/bin/sh' > $FLATPAK_DEST/bin/sudo
        - chmod +x $FLATPAK_DEST/bin/sudo

    - name: midsinstaller
      buildsystem: simple
      build-commands:
      - install mids.sh /app/bin
      #- install -Dm644 com.midsreborn.MidsReborn.svg "${HOME}/.local/share/icons/hicolor/256x256/"
      #- install -Dm644 com.midsreborn.MidsReborn.desktop "${HOME}/.local/share/applications"
      #- install -Dm644 com.midsreborn.MidsReborn.metainfo.xml "${HOME}/.local/share/metainfo"

      sources:
      - type: file
        path: mids.sh
      - type: file
        path: com.midsreborn.MidsReborn.svg
      - type: file
        path: com.midsreborn.MidsReborn.desktop
      - type: file
        path: com.midsreborn.MidsReborn.metainfo.xml

cleanup:

  - "*.a"
  - /lib/debug
  - /lib32/debug
  - /lib64/debug
  - /share/man
  - /include
  - /share/applications/winetricks.desktop
  - /app/share/applications/winetricks.desktop
  - /app/explorer++/"*.txt"
  - /bin/function_grep.pl
  - /bin/widl
  - /bin/wine64-preloader
  - /bin/winebuild
  - /bin/wineconsole
  - /bin/winedbg
  - /bin/winefile
  - /bin/winegcc
  - /bin/winemine
  - /bin/wrc
  - /bin/msidb
  - /bin/notepad
  - /bin/regsvr32
  - /bin/wineboot
  - /bin/winecfg
  - /bin/winecpp
  - /bin/winedump
  - /bin/wineg++
  - /bin/winemaker
  - /bin/winepath
  - /bin/wmc
  - /include
  - /share/man
  - /share/applications
